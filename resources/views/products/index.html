<!DOCTYPE html>
<html lang="lv">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Products CRUD Frontend</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 20px auto;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            th,
            td {
                padding: 8px;
                border: 1px solid #ccc;
                text-align: left;
            }
            input,
            select {
                padding: 6px;
                margin: 5px 0;
                width: 100%;
            }
            button {
                padding: 8px 12px;
                margin-top: 10px;
                cursor: pointer;
            }
            .form-container {
                margin-bottom: 30px;
                border: 1px solid #ddd;
                padding: 15px;
            }
            .hidden {
                display: none;
            }
        </style>
    </head>
    <body>
        <h1>Products CRUD aplikācija</h1>

        <div class="form-container">
            <h2 id="form-title">Pievienot jaunu produktu</h2>
            <form id="product-form">
                <input type="hidden" id="product-id" />

                <label>Nosaukums:</label>
                <input type="text" id="name" required />

                <label>Apraksts:</label>
                <input type="text" id="description" />

                <label>Cena:</label>
                <input type="number" id="price" step="0.01" required />

                <label>Statuss:</label>
                <select id="status" required>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>

                <button type="submit">Saglabāt</button>
                <button type="button" id="cancel-edit" class="hidden">
                    Atcelt
                </button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nosaukums</th>
                    <th>Apraksts</th>
                    <th>Cena</th>
                    <th>Statuss</th>
                    <th>Darbības</th>
                </tr>
            </thead>
            <tbody id="products-table-body"></tbody>
        </table>

        <script>
            const apiUrl = "http://localhost:8000/api/products"; // pielāgo URL atbilstoši savai backend aplikācijai

            const productForm = document.getElementById("product-form");
            const productsTableBody = document.getElementById(
                "products-table-body"
            );
            const formTitle = document.getElementById("form-title");
            const cancelEditBtn = document.getElementById("cancel-edit");

            function fetchProducts() {
                fetch(apiUrl)
                    .then((res) => res.json())
                    .then((products) => {
                        productsTableBody.innerHTML = "";
                        products.forEach((product) => {
                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.description || ""}</td>
                    <td>${product.price}</td>
                    <td>${product.status}</td>
                    <td>
                        <button onclick="editProduct(${
                            product.id
                        })">Labot</button>
                        <button onclick="deleteProduct(${
                            product.id
                        })">Dzēst</button>
                    </td>
                `;
                            productsTableBody.appendChild(tr);
                        });
                    })
                    .catch(console.error);
            }

            function clearForm() {
                productForm.reset();
                document.getElementById("product-id").value = "";
                formTitle.textContent = "Pievienot jaunu produktu";
                cancelEditBtn.classList.add("hidden");
            }

            productForm.addEventListener("submit", function (e) {
                e.preventDefault();

                const id = document.getElementById("product-id").value;
                const name = document.getElementById("name").value.trim();
                const description = document
                    .getElementById("description")
                    .value.trim();
                const price = parseFloat(
                    document.getElementById("price").value
                );
                const status = document.getElementById("status").value;

                const productData = { name, description, price, status };

                if (id) {
                    // Update (PUT)
                    fetch(`${apiUrl}/${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(productData),
                    })
                        .then((res) => {
                            if (!res.ok)
                                throw new Error("Neizdevās atjaunināt");
                            return res.json();
                        })
                        .then(() => {
                            clearForm();
                            fetchProducts();
                        })
                        .catch(alert);
                } else {
                    // Create (POST)
                    fetch(apiUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(productData),
                    })
                        .then((res) => {
                            if (!res.ok) throw new Error("Neizdevās izveidot");
                            return res.json();
                        })
                        .then(() => {
                            clearForm();
                            fetchProducts();
                        })
                        .catch(alert);
                }
            });

            function editProduct(id) {
                fetch(`${apiUrl}/${id}`)
                    .then((res) => res.json())
                    .then((product) => {
                        document.getElementById("product-id").value =
                            product.id;
                        document.getElementById("name").value = product.name;
                        document.getElementById("description").value =
                            product.description || "";
                        document.getElementById("price").value = product.price;
                        document.getElementById("status").value =
                            product.status;
                        formTitle.textContent = `Labot produktu ID ${product.id}`;
                        cancelEditBtn.classList.remove("hidden");
                    })
                    .catch(alert);
            }

            cancelEditBtn.addEventListener("click", clearForm);

            function deleteProduct(id) {
                if (confirm("Vai tiešām dzēst šo produktu?")) {
                    fetch(`${apiUrl}/${id}`, { method: "DELETE" })
                        .then((res) => {
                            if (!res.ok) throw new Error("Neizdevās dzēst");
                            fetchProducts();
                        })
                        .catch(alert);
                }
            }

            // Ielādē sarakstu sākumā
            fetchProducts();
        </script>
    </body>
</html>
